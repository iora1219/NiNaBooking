<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘çš„é ç´„åŸå¸‚</title>

  <!-- Firebaseï¼ˆæ–°æ‰‹å‹å–„ç‰ˆï¼Œä¸ç”¨ importï¼‰ -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day {
      border: 1px solid #ccc;
      padding: 6px;
      border-radius: 6px;
    }

    .date {
      font-weight: bold;
      margin-bottom: 6px;
      text-align: center;
    }

    .slot {
      border: 1px solid #aaa;
      padding: 6px;
      margin: 4px 0;
      border-radius: 6px;
      cursor: pointer;
    }

    .empty {
      background-color: #d4edda;
    }

    .full {
      background-color: #f8d7da;
      color: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

<h2>ğŸ“… 2025 å¹´ 3 æœˆ</h2>

<div class="calendar">
  <div class="day">
    <div class="date">3/10</div>
    <div class="slot empty" data-id="2025-03-10_09">09:00â€“10:00</div>
    <div class="slot empty" data-id="2025-03-10_10">10:00â€“11:00</div>
  </div>

  <div class="day">
    <div class="date">3/11</div>
    <div class="slot empty" data-id="2025-03-11_09">09:00â€“10:00</div>
    <div class="slot empty" data-id="2025-03-11_10">10:00â€“11:00</div>
  </div>

  <div class="day">
    <div class="date">3/12</div>
    <div class="slot empty" data-id="2025-03-12_09">09:00â€“10:00</div>
    <div class="slot empty" data-id="2025-03-12_10">10:00â€“11:00</div>
  </div>
</div>

<script>
  // Firebase è¨­å®šï¼ˆä½ çš„å°ˆæ¡ˆï¼‰
  const firebaseConfig = {
    apiKey: "AIzaSyDPUz-JfM4eowCS2sjq_bkUaOShrm8OFvc",
    authDomain: "booking-2868f.firebaseapp.com",
    projectId: "booking-2868f"
  };

  // å•Ÿå‹• Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const slots = document.querySelectorAll(".slot");

  slots.forEach(slot => {
    const id = slot.dataset.id;

    // è®€å–è³‡æ–™åº«ï¼Œçœ‹é€™å€‹æ™‚æ®µæœ‰æ²’æœ‰äºº
    db.collection("bookings").doc(id).get().then(doc => {
      if (doc.exists) {
        slot.textContent += `ï¼ˆ${doc.data().name}ï¼‰`;
        slot.classList.remove("empty");
        slot.classList.add("full");
      }
    });

    // é»æ“Šé ç´„
    slot.addEventListener("click", () => {
      if (slot.classList.contains("full")) return;

      const name = prompt("è«‹è¼¸å…¥ä½ çš„åå­—");
      if (!name) return;

      // Step 1: æŸ¥è©¢åŒä¸€å€‹æœˆåŒåçš„é ç´„
      const month = id.slice(0,7); // e.g. "2025-03"
      db.collection("bookings")
        .where("name","==",name)
        .get()
        .then(snapshot => {
          let count = 0;
          snapshot.forEach(doc => {
            if(doc.id.startsWith(month)) count++;
          });

          if(count >= 2){
            alert("æ¯å€‹äººæ¯æœˆæœ€å¤šåªèƒ½é ç´„ 2 æ¬¡ï¼");
            return;
          }

          // Step 2: å¯ä»¥é ç´„
          db.collection("bookings").doc(id).set({
            name: name
          }).then(() => {
            slot.textContent += `ï¼ˆ${name}ï¼‰`;
            slot.classList.remove("empty");
            slot.classList.add("full");
          });
        });
    });
  });
</script>

</body>
</html>
